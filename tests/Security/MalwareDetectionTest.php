<?php
/**
 * Developer: Camilo Lozano III - www.camilord.com
 *                              - github.com/camilord
 *                              - linkedin.com/in/camilord
 *
 * utilus - MalwareDetectionTest.php
 * Username: Camilo
 * Date: 8/08/2021
 * Time: 7:29 AM
 */

namespace camilord\utilus\Security;

use PHPUnit\Framework\TestCase;

/**
 * Class MalwareDetectionTest
 * @package camilord\utilus\Security
 */
class MalwareDetectionTest extends TestCase
{
    /**
     * @return MalwareDetection
     */
    public function testObject() {
        $obj = new MalwareDetection();
        $this->assertTrue(($obj instanceof MalwareDetection));

        return $obj;
    }

    /**
     * @param $filename
     * @param $expected
     * @dataProvider getSamples
     */
    public function testDetection($filename, $expected) {
        $obj = $this->testObject();

        $base_path = __DIR__.'/TestData';
        $file_path = $base_path.'/'.$filename;

        $actual = $obj->isMalware($file_path);
        $this->assertSame($expected, $actual);
    }

    /**
     * @return array[]
     */
    public function getSamples() {
        return [
            [
                'file' => '.93176be.ico',
                'expected' => true
            ],
            [
                'file' => 'harmless.jpg',
                'expected' => true
            ],
            [
                'file' => 'yrppzlgi.php',
                'expected' => true
            ],
            [
                'file' => 'IMG_0666.PNG',
                'expected' => false
            ]
        ];
    }
}